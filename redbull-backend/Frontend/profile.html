<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My - Redbull</title>

  <style>
    :root {
      --accent: #0b3d91;
      --muted: #f2f2f2;
      --card: #ffffff;
      --text: #222;
      --bottom-nav-height: 64px;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, Arial, sans-serif;
      background: var(--muted);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      padding-bottom: var(--bottom-nav-height);
      background-image: url("assets/images/bg.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
    }

    /* Back button */
    .back-btn {
      position: fixed;
      top: 12px;
      left: 12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #333;
      z-index: 120;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    }

    /* Banner */
    .top-banner {
      width: 100%;
      min-height: 220px;
      padding: 22px 18px;
      box-sizing: border-box;
      color: #fff;

      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      position: relative;
    }

    .container {
      width: 94%;
      max-width: 920px;
      margin: 0 auto;
    }

    .profile-row {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .avatar {
      width: 76px;
      height: 76px;
      border-radius: 50%;
      border: 4px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #fff;
      background: rgba(255, 255, 255, 0.06);
      flex-shrink: 0;
    }

    .user-meta {
      flex: 1;
    }

    .user-id {
      font-size: 18px;
      font-weight: 800;
      margin: 0 0 8px 0;
      text-shadow: 0 1px 0 rgba(0, 0, 0, 0.12);
    }

    .vip-badge {
      background: rgba(0, 0, 0, 0.18);
      padding: 6px 10px;
      border-radius: 999px;
      display: inline-block;
      color: #fff;
      font-weight: 700;
      font-size: 13px;
    }

    /* Stats */
    .stats-row {
      margin-top: 14px;
      display: flex;
      gap: 12px;
      align-items: stretch;
    }

    .stat-card {
      flex: 1;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.06);
      min-height: 72px;
    }

    .stat-value {
      font-weight: 800;
      color: var(--accent);
      font-size: 20px;
      margin-bottom: 6px;
    }

    .stat-label {
      font-size: 13px;
      color: #666;
    }

    /* Menu list */
    main.menu-section {
      margin-top: 16px;
      margin-bottom: 120px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.04);
      margin: 12px 0 4px;
      cursor: pointer;
    }

    .menu-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, #fff, #f7efe9);
      color: var(--accent);
      font-weight: 800;
    }

    .menu-text {
      font-weight: 700;
      color: #333;
      font-size: 15px;
    }

    .chev {
      color: #b58b6f;
      font-size: 20px;
    }

    /* Detail panels (collapsible) */
    .detail-panel {
      display: none;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
      padding: 12px 14px;
      font-size: 14px;
      color: #333;
      line-height: 1.4;
    }

    .detail-panel p {
      margin: 4px 0;
    }

    .detail-panel strong {
      color: var(--accent);
    }

    /* Bottom nav */
    .bottom-nav {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 14px;
      z-index: 60;
      box-sizing: border-box;
      pointer-events: none;
      height: auto;
    }

    .nav-inner {
      display: flex;
      gap: 6px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 40px;
      padding: 8px 10px;
      box-shadow: 0 18px 40px rgba(10, 30, 80, 0.12);
      pointer-events: auto;
      min-width: 320px;
      max-width: 92vw;
      align-items: center;
    }

    .nav-link {
      padding: 8px 14px;
      border-radius: 28px;
      text-decoration: none;
      color: var(--accent);
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: 0.14s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .nav-link.active {
      background: linear-gradient(180deg, var(--accent), #08306a);
      color: #fff;
      box-shadow: 0 10px 30px rgba(11, 39, 77, 0.16);
      transform: translateY(-3px);
    }

    .menu-item:focus {
      outline: 3px solid rgba(139, 61, 46, 0.12);
      outline-offset: 2px;
    }

    .back-btn:focus {
      outline: 3px solid rgba(139, 61, 46, 0.16);
      outline-offset: 2px;
    }

    @media (max-width: 480px) {
      .avatar {
        width: 64px;
        height: 64px;
      }

      .user-id {
        font-size: 16px;
      }

      .stat-value {
        font-size: 18px;
      }

      .menu-text {
        font-size: 14px;
      }

      .top-banner {
        padding: 18px 12px;
        min-height: 200px;
      }

      .nav-inner {
        min-width: 260px;
        gap: 4px;
        padding: 6px 8px;
      }

      .nav-link {
        padding: 6px 10px;
        font-size: 13px;
      }
    }

    /* Logout confirmation modal */
    .logout-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .logout-card {
      width: 320px;
      max-width: 94%;
      background: #fff;
      border-radius: 14px;
      padding: 18px 16px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
    }

    .logout-title {
      font-weight: 800;
      font-size: 16px;
      margin-bottom: 6px;
      color: #222;
    }

    .logout-body {
      font-size: 14px;
      color: #555;
      margin-bottom: 14px;
    }

    .logout-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .btn-ghost {
      padding: 8px 14px;
      border-radius: 10px;
      border: 1px solid #e1e4f0;
      background: #f5f6fc;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    .btn-danger {
      padding: 8px 14px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #ef4444, #b91c1c);
      color: #fff;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
    }

    .hidden {
      display: none;
    }

    .edit-field {
      width: 100%;
      padding: 6px;
      margin: 5px 0 12px;
      border: 1px solid #cfd4e2;
      border-radius: 8px;
      font-size: 14px;
    }

    .edit-field:disabled {
      background: #eee;
      color: #777;
    }

    .btn-edit {
      padding: 8px 14px;
      border-radius: 10px;
      background: linear-gradient(135deg, #0b3d91, #08306a);
      color: #fff;
      border: none;
      font-weight: 700;
      cursor: pointer;
    }

    .btn-save {
      padding: 8px 14px;
      border-radius: 10px;
      background: linear-gradient(135deg, #38a169, #1d7f4e);
      color: #fff;
      border: none;
      font-weight: 700;
      cursor: pointer;
      opacity: 0.6;
    }

    .btn-save.enabled {
      opacity: 1;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <!-- Back button -->
  <button class="back-btn" id="backBtn" aria-label="Back">‚Üê</button>

  <!-- Banner -->
  <section id="banner" class="top-banner" aria-label="Profile banner">
    <div class="container">
      <div class="profile-row">
        <div class="avatar" id="avatarText" aria-hidden="true">U</div>
        <div class="user-meta">
          <div id="userId" class="user-id">ID : -</div>
          <div class="vip-badge" id="vipBadge" aria-hidden="true">VIP0</div>
        </div>
        <div style="width: 48px"></div>
      </div>

      <div class="stats-row" aria-label="Account stats">
        <div class="stat-card" aria-label="Balance">
          <div class="stat-value" id="balance">‚Çπ 0</div>
          <div class="stat-label">Balance</div>
        </div>

        <div class="stat-card" aria-label="Total income">
          <div class="stat-value" id="totalIncome">‚Çπ 0</div>
          <div class="stat-label">Estimated income</div>
        </div>

        <div class="stat-card" aria-label="Recharge">
          <div class="stat-value" id="rechargeVal">‚Çπ 0</div>
          <div class="stat-label">Total plans</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Menu items + detail panels -->
  <main class="menu-section container" style="margin-bottom: 120px; padding: 20px" role="main">
    <!-- Personal info -->
    <div class="menu-item" id="m-personal" tabindex="0" role="button" aria-label="Personal information">
      <div class="menu-left">
        <div class="menu-icon">üë§</div>
        <div class="menu-text">Personal information</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-personal" class="detail-panel">
      <p><strong>Name:</strong> <span id="piNameText">-</span></p>
      <input id="piNameInput" type="text" class="edit-field" style="display: none" />

      <p><strong>Address:</strong> <span id="piAddressText">-</span></p>
      <input id="piAddressInput" type="text" class="edit-field" style="display: none" />

      <p><strong>Phone:</strong> <span id="piPhoneText">-</span></p>

      <p><strong>Referral Code:</strong> <span id="piRefText">-</span></p>

      <div style="margin-top: 10px; display: flex; gap: 10px">
        <button id="editBtn" class="btn-edit">Edit</button>
        <button id="saveBtn" class="btn-save" style="display: none">
          Save
        </button>
      </div>

      <p id="updateMsg" style="color: green; font-weight: 600; display: none">
        Profile updated successfully!
      </p>
    </div>

    <!-- My Plans -->
    <div class="menu-item" id="m-plans" tabindex="0" role="button" aria-label="My Plans">
      <div class="menu-left">
        <div class="menu-icon">üì¶</div>
        <div class="menu-text">My Plans</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-plans" class="detail-panel">
      <p style="color: #777; font-size: 13px;">Loading plans...</p>
    </div>

    <!-- Income details -->
    <div class="menu-item" id="m-income" tabindex="0" role="button" aria-label="Income details">
      <div class="menu-left">
        <div class="menu-icon">üìã</div>
        <div class="menu-text">Income details</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-income" class="detail-panel">
      <p><strong>Wallet balance:</strong> ‚Çπ <span id="piWallet">0</span></p>
      <p>
        <strong>Number of active plans:</strong>
        <span id="piPlansCount">0</span>
      </p>
      <p>
        Income is generated daily based on your purchased plans and referral
        rewards credited to your wallet.
      </p>
    </div>

    <!-- About us -->
    <div class="menu-item" id="m-about" tabindex="0" role="button" aria-label="About us">
      <div class="menu-left">
        <div class="menu-icon">üè¢</div>
        <div class="menu-text">About us</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-about" class="detail-panel">
      <p>
        Redbull Income is an online earning platform inspired by the global
        Redbull energy drink brand. Users can purchase subscription plans,
        earn daily income, and receive rewards by inviting new members to join
        through referral links.
      </p>
      <p>
        We focus on transparent plan rules, simple wallet management, and
        reward distribution so that every user can clearly see how much they
        earn from their plans and team.
      </p>
    </div>

    <!-- Withdrawal details -->
    <div class="menu-item" id="m-withdrawal" tabindex="0" role="button" aria-label="Withdrawal details">
      <div class="menu-left">
        <div class="menu-icon">üí≥</div>
        <div class="menu-text">Withdrawal details</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-withdrawal" class="detail-panel">
      <p><strong>Minimum withdrawal:</strong> ‚Çπ130</p>
      <p><strong>Service charge:</strong> 10% on each payout.</p>
      <p>
        When a withdrawal is processed, 10% of the requested amount is
        deducted as a service fee and credited back to the wallet as per
        platform rules, and the remaining 90% is paid out.
      </p>

      <hr style="margin: 12px 0; border: 0; border-top: 1px solid #eee;">
      <h4 style="margin: 0 0 8px 0; font-size: 15px;">History</h4>
      <div id="withdrawHistory" style="max-height: 200px; overflow-y: auto;">
        <p style="color: #777; font-size: 13px;">Loading history...</p>
      </div>
    </div>

    <!-- Recharge details -->
    <div class="menu-item" id="m-recharge" tabindex="0" role="button" aria-label="Recharge details">
      <div class="menu-left">
        <div class="menu-icon">‚§¥</div>
        <div class="menu-text">Recharge details</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
    <div id="panel-recharge" class="detail-panel">
      <p>
        You can recharge your wallet through the
        <strong>Recharge</strong> page. After successful payment, the amount
        is added to your wallet and can be used to purchase plans.
      </p>
      <p>
        Every new user also receives a one-time bonus on their
        <strong>first plan purchase</strong> as per current offer.
      </p>
    </div>

    <!-- Logout -->
    <div class="menu-item" id="m-logout" tabindex="0" role="button" aria-label="Log out" style="margin-top: 18px">
      <div class="menu-left">
        <div class="menu-icon" style="color: #d33">‚èª</div>
        <div class="menu-text">Log out</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
  </main>

  <!-- Bottom nav -->
  <footer class="bottom-nav" role="navigation" aria-label="Bottom navigation">
    <div class="nav-inner" role="group" aria-label="Main navigation">
      <a href="home.html" class="nav-link" id="nav-plan">Plan</a>
      <a href="share.html" class="nav-link" id="nav-share">Share</a>
      <a href="team.html" class="nav-link" id="nav-team">Team</a>
      <a href="profile.html" class="nav-link active" id="nav-my">My</a>
    </div>
  </footer>

  <!-- Logout confirmation modal -->
  <div id="logoutOverlay" class="logout-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="logoutTitle">
    <div class="logout-card">
      <div id="logoutTitle" class="logout-title">Log out?</div>
      <div class="logout-body">
        Are you sure you want to log out from this account?
      </div>
      <div class="logout-actions">
        <button id="logoutCancel" class="btn-ghost">Cancel</button>
        <button id="logoutConfirm" class="btn-danger">Yes, log out</button>
      </div>
    </div>
  </div>

  <script>
    (() => {
      const API = "http://localhost:4000";
      const token = localStorage.getItem("authToken");

      if (!token) {
        window.location.href = "index.html";
        return;
      }

      /* -----------------------------------------------------
   BACK BUTTON
----------------------------------------------------- */
      document.getElementById("backBtn").onclick = () => {
        window.location.href = "home.html";
      };

      /* -----------------------------------------------------
   LOGOUT FIX
----------------------------------------------------- */
      const logoutOverlay = document.getElementById("logoutOverlay");
      document.getElementById("m-logout").onclick = () => {
        logoutOverlay.classList.remove("hidden");
      };

      document.getElementById("logoutCancel").onclick = () =>
        logoutOverlay.classList.add("hidden");

      document.getElementById("logoutConfirm").onclick = () => {
        localStorage.removeItem("authToken");
        window.location.href = "index.html";
      };

      /* -----------------------------------------------------
    PANEL TOGGLE (Collapsible sections)
----------------------------------------------------- */
      const panelMap = {
        "m-personal": "panel-personal",
        "m-plans": "panel-plans",
        "m-income": "panel-income",
        "m-about": "panel-about",
        "m-withdrawal": "panel-withdrawal",
        "m-recharge": "panel-recharge",
      };

      function togglePanel(menuId) {
        const panelId = panelMap[menuId];
        for (const p of Object.values(panelMap)) {
          if (p !== panelId)
            document.getElementById(p).style.display = "none";
        }
        const panel = document.getElementById(panelId);
        panel.style.display =
          panel.style.display === "block" ? "none" : "block";
      }

      Object.keys(panelMap).forEach((id) => {
        const el = document.getElementById(id);
        el.onclick = () => togglePanel(id);
      });

      /* ---------------------------------------------------------
  ENABLE EDIT MODE
--------------------------------------------------------- */
      const nameText = document.getElementById("piNameText");
      const addressText = document.getElementById("piAddressText");

      const nameInput = document.getElementById("piNameInput");
      const addressInput = document.getElementById("piAddressInput");

      const phoneText = document.getElementById("piPhoneText");
      const refText = document.getElementById("piRefText");

      const editBtn = document.getElementById("editBtn");
      const saveBtn = document.getElementById("saveBtn");

      /* ---------------- SHOW EDIT MODE ---------------- */
      editBtn.addEventListener("click", () => {
        // Hide text ‚Üí show input fields
        nameText.style.display = "none";
        nameInput.style.display = "block";

        addressText.style.display = "none";
        addressInput.style.display = "block";

        // Fill inputs with current values
        nameInput.value = nameText.textContent;
        addressInput.value = addressText.textContent;

        // Buttons toggle
        editBtn.style.display = "none";
        saveBtn.style.display = "block";
      });

      /* ---------------- SAVE UPDATE TO BACKEND ---------------- */
      saveBtn.addEventListener("click", async () => {
        const body = {
          name: nameInput.value.trim(),
          address: addressInput.value.trim(),
        };

        const res = await fetch(API + "/api/user/profile", {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify(body),
        });

        const data = await res.json();

        if (!data.success) {
          alert(data.message);
          return;
        }

        // Update UI with new values
        nameText.textContent = body.name;
        addressText.textContent = body.address;

        // Switch back to text mode
        nameInput.style.display = "none";
        addressInput.style.display = "none";

        nameText.style.display = "inline";
        addressText.style.display = "inline";

        // Button toggle
        saveBtn.style.display = "none";
        editBtn.style.display = "block";

        // Success message
        updateMsg.style.display = "block";
        setTimeout(() => (updateMsg.style.display = "none"), 1500);
      });

      /* -----------------------------------------------------
   LOAD PROFILE FROM BACKEND
   /api/user/profile  ‚Üí returns full user
----------------------------------------------------- */
      async function loadProfile() {
        try {
          const res = await fetch(API + "/api/user/profile", {
            headers: { Authorization: "Bearer " + token },
          });

          const data = await res.json();
          if (!data.success) return;

          const u = data.user;

          /* TOP BANNER DETAILS */
          document.getElementById("userId").textContent =
            "ID : " + (u.phone || "-");
          document.getElementById("avatarText").textContent = (
            u.phone || "U"
          ).slice(-4);

          /* WALLET + PLANS */
          const wallet = u.wallet || 0;
          const plans = u.plans || [];

          document.getElementById("balance").textContent = "‚Çπ " + wallet;
          document.getElementById("piWallet").textContent = wallet;

          document.getElementById("piPlansCount").textContent = plans.length;

          /* PERSONAL INFO */
          nameText.textContent = u.name || "-";
          addressText.textContent = u.address || "-";
          phoneText.textContent = u.phone || "-";
          refText.textContent = u.referralCode || "-";

          /* ESTIMATED INCOME (wallet + plan amounts) */
          const totalPlanValue = plans.reduce(
            (sum, p) => sum + Number(p.amount || 0),
            0
          );

          document.getElementById("rechargeVal").textContent =
            "‚Çπ " + totalPlanValue;
          document.getElementById("totalIncome").textContent =
            "‚Çπ " + (wallet + totalPlanValue);

          /* -----------------------------------------------------
       SHOW ACTIVE PLANS (inside My Plans panel)
    ----------------------------------------------------- */
          const plansPanel = document.getElementById("panel-plans");
          if (plansPanel) {
            if (plans.length === 0) {
              plansPanel.innerHTML = "<p>No active plans</p>";
            } else {
              let html = "";
              plans.forEach((p) => {
                const d = new Date(p.startDate || p.purchaseDate || Date.now()).toLocaleString();
                html += `
                <div style="border-bottom: 1px solid #eee; padding: 8px 0; margin-bottom: 8px;">
                  <div style="font-weight: 700; color: var(--accent); font-size: 15px;">${p.name || p.planName || "Plan"}</div>
                  <div style="display: flex; justify-content: space-between; font-size: 13px; color: #555; margin-top: 4px;">
                    <span>Price: ‚Çπ${p.amount || p.price}</span>
                    <span>Daily: ‚Çπ${p.daily}</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; font-size: 13px; color: #555; margin-top: 2px;">
                    <span>Days: ${p.days}</span>
                    <span>Date: ${d.split(',')[0]}</span>
                  </div>
                </div>
              `;
              });
              plansPanel.innerHTML = html;
            }
          }

          /* -----------------------------------------------------
       SHOW ACTIVE PLANS (inside income panel - kept for summary)
    ----------------------------------------------------- */
          const incomePanel = document.getElementById("panel-income");

          const planList = document.createElement("div");
          planList.style.marginTop = "10px";

          if (plans.length === 0) {
            planList.innerHTML = "<p>No active plans</p>";
          } else {
            planList.innerHTML = "<strong>Active Plans Summary:</strong><br>";
            plans.forEach((p) => {
              planList.innerHTML += `<div style="font-size:13px; margin-top:4px;">‚Ä¢ ${p.name || p.planName} (‚Çπ${p.amount || p.price})</div>`;
            });
          }

          incomePanel.appendChild(planList);

          /* -----------------------------------------------------
       SHOW USER RECHARGE HISTORY (payment table)
    ----------------------------------------------------- */
          loadRechargeHistory();
          loadWithdrawHistory();
        } catch (err) {
          console.error("Error loading profile:", err);
        }
      }

      /* -----------------------------------------------------
    LOAD PAYMENT HISTORY (RECHARGES)
    /api/payment/user ‚Äî we will add this backend route now
----------------------------------------------------- */
      async function loadRechargeHistory() {
        const rechargePanel = document.getElementById("panel-recharge");

        try {
          const res = await fetch(API + "/api/payment/user", {
            headers: { Authorization: "Bearer " + token },
          });

          const data = await res.json();

          if (!data.success || !data.payments) {
            rechargePanel.innerHTML += "<p>No recharge history found.</p>";
            return;
          }

          rechargePanel.innerHTML = "<strong>Recharge History:</strong><br>";

          data.payments.forEach((p) => {
            const dt = new Date(p.createdAt).toLocaleString();
            rechargePanel.innerHTML += `
            <p>
              Amount: ‚Çπ${p.amount}<br>
              UTR: ${p.utr}<br>
              Status: ${p.status}<br>
              Date: ${dt}
            </p>
        `;
          });
        } catch (err) {
          rechargePanel.innerHTML += "<p>Error loading recharge history</p>";
        }
      }

      /* -----------------------------------------------------
    LOAD WITHDRAWAL HISTORY
    /api/withdraw/history
----------------------------------------------------- */
      async function loadWithdrawHistory() {
        const withdrawPanel = document.getElementById("withdrawHistory");
        if (!withdrawPanel) return;

        try {
          const res = await fetch(API + "/api/withdraw/history", {
            headers: { Authorization: "Bearer " + token },
          });
          const data = await res.json();

          if (!data.success || !data.withdrawals || data.withdrawals.length === 0) {
            withdrawPanel.innerHTML = '<p style="color: #777; font-size: 13px;">No withdrawal history found.</p>';
            return;
          }

          let html = "";
          data.withdrawals.forEach((w) => {
            const date = new Date(w.createdAt).toLocaleDateString();
            let statusColor = "#f59e0b"; // pending - orange
            if (w.status === "approved") statusColor = "#10b981"; // green
            if (w.status === "rejected") statusColor = "#ef4444"; // red

            html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px;">‚Çπ${w.amount}</div>
                                <div style="font-size: 11px; color: #666;">
                                  Payable: <b>‚Çπ${w.payable || (w.amount * 0.9).toFixed(2)}</b> (Fee: ‚Çπ${w.fee || (w.amount * 0.1).toFixed(2)})
                                </div>
                                <div style="font-size: 12px; color: #888;">${date}</div>
                            </div>
                            <div style="font-size: 12px; font-weight: 700; color: ${statusColor}; text-transform: capitalize;">
                                ${w.status}
                            </div>
                        </div>
                    `;
          });
          withdrawPanel.innerHTML = html;
        } catch (e) {
          console.error("Error loading history:", e);
          withdrawPanel.innerHTML = '<p style="color: red; font-size: 13px;">Failed to load history.</p>';
        }
      }

      /* -----------------------------------------------------
    INITIAL LOAD
----------------------------------------------------- */
      document.addEventListener("DOMContentLoaded", loadProfile);
    })();
  </script>
</body>

</html>