<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Withdraw</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    :root {
      --bg-ui: #0b274d;
      --accent: #0e4aa8;
      --muted: #f4f6fb;
      --card: #ffffff;
      --shadow: 0 10px 30px rgba(2, 8, 23, 0.35);
      --radius: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: Inter, system-ui;
    }

    body {
      background: linear-gradient(180deg, #f2f6fb 0%, #eef3fb 100%);
      color: #0b274d;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .container {
      max-width: 980px;
      margin: 18px auto;
      padding: 10px;
      width: 94%;
    }

    header.app-header {
      position: sticky;
      top: 0;
      z-index: 60;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      background: linear-gradient(90deg, var(--accent), var(--bg-ui));
      color: #fff;
      font-weight: 700;
      min-height: 56px;
    }

    header .back-btn {
      background: transparent;
      border: 0;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
    }

    .title {
      flex: 1;
      font-size: 18px;
      color: #fff;
    }

    .tabs-row {
      display: flex;
      gap: 12px;
      margin-top: 14px;
    }

    .tab-switch {
      padding: 10px 28px;
      border-radius: 10px;
      background: #fff;
      border: 1px solid #d9dce3;
      font-weight: 700;
      color: var(--bg-ui);
      cursor: pointer;
    }

    .tab-switch.active {
      background: linear-gradient(90deg, var(--accent), var(--bg-ui));
      color: #fff;
      border: none;
    }

    .rech-card {
      background: #fff;
      padding: 18px;
      border-radius: 14px;
      margin-bottom: 16px;
    }

    .balance-label {
      margin-bottom: 6px;
      font-weight: 600;
    }

    .input-box {
      display: flex;
      gap: 8px;
      border-radius: 10px;
      border: 1px solid #e6e9f2;
      padding: 10px;
    }

    .rs {
      font-weight: 700;
    }

    input {
      border: 0;
      outline: 0;
      width: 100%;
      font-size: 16px;
    }

    .pay-btn {
      width: 100%;
      background: linear-gradient(180deg, var(--bg-ui), var(--accent));
      color: #fff;
      border: none;
      padding: 14px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 10px;
      font-size: 16px;
    }
  </style>
</head>

<body>
  <header class="app-header">
    <button class="back-btn" id="backBtn">←</button>
    <div class="title">Withdraw</div>
    <div id="walletBtn">Wallet: ₹0</div>
  </header>

  <div class="container">
    <div class="tabs-row">
      <button class="tab-switch" onclick="window.location.href='recharge.html'">Recharge</button>
      <button class="tab-switch active">Withdraw</button>
    </div>

    <div class="rech-card">
      <div class="balance-label">Amount</div>
      <div class="input-box">
        <div class="rs">₹</div>
        <input id="withAmountInput" type="number" placeholder="Enter Amount" />
      </div>
      <div class="balance-label">Balance: <b id="balanceText">₹0</b></div>
      <button onclick="handleWithdraw()" class="pay-btn">Submit Withdraw</button>
    </div>

    <div class="rech-card">
      <div class="balance-label">Real Name</div>
      <div class="input-box">
        <input id="bankName" placeholder="Enter your real name" />
      </div>

      <div class="balance-label">IFSC</div>
      <div class="input-box">
        <input id="bankIFSC" placeholder="Enter IFSC" />
      </div>

      <div class="balance-label">Account Number</div>
      <div class="input-box">
        <input id="bankAccount" placeholder="Enter bank account number" />
      </div>

      <div class="balance-label">Mobile Number</div>
      <div class="input-box">
        <input id="bankMobile" placeholder="Enter mobile number" />
      </div>
    </div>
  </div>

  <script>
    // Dynamic API Base URL logic
    const API = (function () {
      const host = location.hostname;
      if (host === "localhost" || host === "127.0.0.1") {
        return "http://localhost:4000/api";
      }
      return "/api";
    })();
    const token = localStorage.getItem("authToken");

    if (!token) {
      alert("Login again");
      window.location.href = "index.html";
    }

    document.getElementById("backBtn").onclick = () => history.back();

    async function loadWallet() {
      try {
        const res = await fetch(`${API}/user/profile`, {
          headers: { Authorization: `Bearer ${token}` },
        });
        const data = await res.json();
        if (data.success && data.user) {
          document.getElementById("walletBtn").innerText = "Wallet: ₹" + data.user.wallet;
          document.getElementById("balanceText").innerText = "₹" + data.user.wallet;
        }
      } catch (e) {
        console.error("Error loading wallet:", e);
      }
    }

    loadWallet();

    async function handleWithdraw() {
      const amount = Number(document.getElementById("withAmountInput").value);
      const name = document.getElementById("bankName").value;
      const ifsc = document.getElementById("bankIFSC").value;
      const account = document.getElementById("bankAccount").value;
      const mobile = document.getElementById("bankMobile").value;

      if (!amount || !name || !ifsc || !account || !mobile) {
        return alert("Fill all details");
      }

      const res = await fetch(`${API}/withdraw/request`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify({
          amount,
          bankName: name,
          ifsc,
          account,
          mobile,
        }),
      });

      const data = await res.json();
      alert(data.message);
      loadWallet();
    }
  </script>
</body>

</html>